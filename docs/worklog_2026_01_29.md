# 작업 로그
2026-01-29

## 목표
- AI POI 추천 서버 인프라 구축 및 Cloud Run 배포 최적화
- GCS FUSE를 이용한 대용량 임베딩 데이터 연동
- GitHub Actions를 통한 CI/CD 파이프라인 완성

## 변경 사항
- 인프라 사양 증설: 모델 로딩 및 디스크 공간 확보를 위해 메모리를 4Gi -> 8Gi, CPU를 2 -> 4로 상향 조정.
- 포트 표준화: 내부 컨테이너 포트와 Cloud Run 서비스 포트를 8000번으로 통일 및 Dockerfile 수정.
- GCS 마운트 경로 교정:
  - 기존 /app/data 마운트 시 소스 코드와 경로 불일치 발생.
  - 테라폼의 mount_path를 /data로 수정하여 코드 내 FileNotFoundError 해결.
- 보안 설정: iam_member 리소스를 추가하여 allUsers에게 roles/run.invoker 권한 부여 (공개 API 전환).
- Dockerfile 최적화:
  - 빌드 단계에서 SentenceTransformer('BAAI/bge-m3')를 실행하여 이미지 내에 모델을 미리 포함(Pre-load).
  - 배포 시마다 발생하는 2.3GB 모델 다운로드 병목 및 디스크 부족 에러 해결.
- Terraform 동기화: lifecycle { ignore_changes = [...] } 설정을 통해 GitHub Actions에서 관리하는 환경 변수(Secrets)와 테라폼 간의 충돌 방지.

## 추가 작업
- 인증 에러 해결: allUsers 권한 부여를 통해 브라우저 및 외부 API 호출 시의 403 Forbidden 에러 해결.
- Swagger UI 활성화: /docs 경로 접속 확인 및 API 명세서 접근 허용.
- 환경 변수 관리: GitHub Secrets로 key를 관리하고, 나머지 설정 값은 GitHub Actions yml 파일에 정리되어 있으므로 .env 파일 로딩은 필수가 아님.
- 배포 자동화: park_research 브랜치 푸시 시 GitHub Actions를 통해 자동 배포.

## 설정/환경변수
- Terraform: google_cloud_run_v2_service, google_storage_bucket, google_cloud_run_v2_service_iam_member
- Cloud Run: Timeout 600s, Memory 8Gi, CPU 4, Port 8000
- GCS: ai-park-embeddings-data 버킷 생성 및 /data 경로 마운트
